clear all
close all
syms x y z phi xd yd zd phid s nul
% State space model
% JN = [-0.20762593060817214241638732593171, -0.23245986675368324239448136978406, -0.0031265063260386390320233511117437, -0.0014529533573486837275415207493709, -0.045559874874660308671364558456895, 0.0067279385776518848294988596868114
% -0.096905435017928474240930464369099,  0.10952484719287668831267966256058,   0.071541280228528712918709447190543,  -0.066141807317286712010941528689231,   0.79523891196150283393479078160504,  0.013631830107056137446571765792743
%  -0.21761385559976061892767133262655,  0.22743749264166358764956789554129,   0.061089000640258202764810046983699,  -0.055208714779747817817602330067849,   0.24083528696178882674713048423584,   -0.1911905899697189886068550417259
% -0.052572012103565040235648801980749, 0.073637051808032655958465505296311,    0.85305051716279225586355721033291,   -0.82595352719605633819128340066142,   -11.382546994323709378602022112162,    5.3270039490828510292055376020129]

JN = [ -0.20771975829871329322329598151058, -0.23235516266580107609818883314799, -0.0030989214804624702943746891477276, -0.0014744228637901074169101910254576, -0.045142462056095463391942432835627, 0.0065354951894041505513693448178355
-0.095356149431675710549550406122302,  0.10779076257432182357094152627775,   0.071158092578942269718020683328014,  -0.065849446331512732951360959641236,   0.78816505857766371344719828603766,  0.016531434834398674349127397547401
 -0.21680259615987569262372623625974,  0.22656282984490139724140440348812,   0.061287239968408633758112915058208,  -0.055440474704292313772357277323577,   0.23788768729215469876469127903519,  -0.19347297737536793023071567701751
-0.078521513467196400932159470025429,  0.10245053364461251115692075547534,    0.86228682903550538953767300698161,   -0.83378191651249521747491587434239,   -11.272246930949384669854415001431,    5.2670213884245996623534789990332]
 

tau = [2.7289082151607819485995721558587
 -2.8520979989754310346964280423926
-0.76606462048892744850246919694968
 0.69232501255810675465395476898169
 -3.0201082154410063394780940296556
  2.3975567649028717203121080263684]
A = zeros(8,8); A(1,5) = 1; A(2,6) = 1; A(3,7) = 1; A(4,8) = 1
B = [zeros(4,6);pinv(JN')];
C = zeros(4,8); C(1,1) = 1; C(2,2) = 1; C(3,3) = 1; C(4,4) = 1
D = zeros(4,6);

O=[zeros(7,6);B(8,:)]*2180 %2180 = 1/I
B(8,:)=zeros(1,6)
B=B*1/1.28+O+[0 0 0 0 0 0 1.28*9.82 0]'

%D = 0
X = [x;y;z;phi;xd;yd;zd;phid]
Y = [x;y;z;phi]

% Compute transfer function
%s = tf('s')
i = eye(length(A));
G = C*((s*i)-A)^-1*B+D

% Compute poles and zeroes
poles = eig(A)
sys = ss(A,B,C,D)
[Z,nrank] = tzero(sys)
%solve(det(zero_matrix) == 0, nul) % Not possible for non-square matrices
size(A); size(B); size(C); size(D);

C_matrix = [B A*B A^2*B A^3*B A^4*B A^5*B A^6*B A^7*B];

% Is system controllable?
% If controllability matrix has rank=8, system is controlable
rank(C_matrix)
cond(C_matrix)