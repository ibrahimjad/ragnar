%% System 
clear all
close all
%Old jacobian
% J = [ -0.20771975829871329322329598151058, -0.23235516266580107609818883314799, -0.0030989214804624702943746891477276, -0.0014744228637901074169101910254576, -0.045142462056095463391942432835627, 0.0065354951894041505513693448178355;
% -0.095356149431675710549550406122302,  0.10779076257432182357094152627775,   0.071158092578942269718020683328014,  -0.065849446331512732951360959641236,   0.78816505857766371344719828603766,  0.016531434834398674349127397547401;
%  -0.21680259615987569262372623625974,  0.22656282984490139724140440348812,   0.061287239968408633758112915058208,  -0.055440474704292313772357277323577,   0.23788768729215469876469127903519,  -0.19347297737536793023071567701751;
% -0.078521513467196400932159470025429,  0.10245053364461251115692075547534,    0.86228682903550538953767300698161,   -0.83378191651249521747491587434239,   -11.272246930949384669854415001431,    5.2670213884245996623534789990332];
% 
% %Jacobian in pick-up (cond = 50.01)
% J = [ -0.18694397587924150310810773552862, -0.19845953623146443565747308328582,    0.1984595527813495306042924093325,  0.18694399566893818148350511705346, -0.031031496551868188184918455205543, -0.031031488042035514064207572539474;
%  -0.11925344012413167688855991913216, 0.098634678935816080281149893237651,  0.098634589241577299301649339684686, -0.11925360409160437427770297942517,    0.4086169691492114362682408090451,  -0.40861722084467454417538105500042;
% -0.059939105468865578875850067574626, 0.053013947895349051043307813362931, -0.053013958954101748575564810462909, 0.059939121033093944949091798026678,  -0.16072912909710927048904352176941,  -0.16072905697238834371719566283776;
% [ -0.15721759213225984664046923275351,  0.44834455259519178054157645885135,   0.44834685236107719380381612007545, -0.15721455836053013975356488998438,   -8.6748996343072001980612837037677,    8.6749024107447437281129689814393];

%Jacobian in hand-off (cond = 45.56)
J = [ -0.20692744238625918480350970935772, -0.23282465150808832388798617301067, -0.0018037394338624440108555852751087, -0.0027237770654514239686242003705982, -0.046616676828534540626855364172696, -0.0043748266894397930680961665394113;
 -0.09440614997175165108304277955125,  0.10209781154318461836545535862476,   0.078089231278121947994100512042756,  -0.072098953728305185208200060909319,    0.7805471762235340934000536416031,  -0.040288946639337048302070978576621;
 -0.21627192163420201278899880299186,  0.22559725618732246493193350428491,   0.059792826385790176857266488243252,  -0.053883416061764900301277363243659,   0.23621817697563653972723486143913,   -0.18405060743418255596581026724899;
-0.041545569051812333499312072499567,  0.11163173537246140150506802982555,     0.9660893787883126728554260627726,   -0.93960574614494256095106946083486,   -11.307111158243912352730846661859,     4.4612301412348968719237050190032];

 
A = zeros(8,8); A(1,5) = 1; A(2,6) = 1; A(3,7) = 1; A(4,8) = 1;
BScal = [zeros(8,4)];
BScal(8,4) = 2180;
BScal(7,3) = 1/1.28;
BScal(6,2) = 1/1.28;
BScal(5,1) = 1/1.28;
B = BScal
%B = BScal*[zeros(4,6);pinv(J')];
C = zeros(4,8); C(1,1) = 1; C(2,2) = 1; C(3,3) = 1; C(4,4) = 1;
D = zeros(4,6);

% %% Preliminary feedback
% % Preliminary feedback. Makes random cornections between the inputs and
% % outputs. This makes it posibul to thave one ruleing input.
% F_pre = [5.3592e-01   1.2839e-01   8.8167e-01  -6.5862e-01   1.5337e-01  -1.5666e+00  -2.8614e+00   6.7119e-01
%    6.9286e-01   1.0395e+00  -5.6144e-02   9.8399e-01  -3.1702e-01   1.0571e+00   5.3556e-01   1.5090e-01
%   -6.8755e-01  -1.1677e-01  -8.4124e-01   1.0123e-01   3.1892e-01  -5.8758e-01  -3.4204e-01  -9.9132e-01
%    3.1758e-01  -6.4830e-01  -1.5484e-01  -3.6271e-01  -1.4565e+00   3.0222e-01  -5.9786e-01   8.3683e-01
%    1.6284e-01  -3.7981e-02   1.1886e+00  -7.3883e-01   1.3218e+00   2.1946e-01   4.1891e-01   4.7451e-01
%    1.1591e+00  -1.9932e-01  -4.1491e-01  -1.4798e+00   4.8720e-01  -8.7820e-01  -6.8968e-01   1.2522e+00];
% 
% Acl = (A+B*F_pre); %A closed-loop with FPre